!function(){"use strict";var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,s=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&a(e,r,t[r]);if(o)for(var r of o(t))i.call(t,r)&&a(e,r,t[r]);return e},l=(e,o)=>t(e,r(o)),c=(e,t,r)=>new Promise((o,n)=>{var i=e=>{try{s(r.next(e))}catch(t){n(t)}},a=e=>{try{s(r.throw(e))}catch(t){n(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,a);s((r=r.apply(e,t)).next())});function d(e){const t=x(document.cookie,"; ").find(t=>{const{name:r}=u(t);return r===e});return!!t&&u(t).value}function u(e){const[t,...r]=x(e,"=");return{name:t,value:w(r)>0&&decodeURIComponent(r.join("="))}}var h="https://xef5-44zo-gegm.b2.xano.io";function p(e,t=!1,r){return t||this&&401===this.status&&(location.href=y("/log-in",{redirect_to:encodeURIComponent(location.pathname+location.search)})),null==r||r(),{message:e,succeeded:!1}}function f(e,t){return null==t||t(),{data:e,succeeded:!0}}function v(e=[],t="GET"){const r="application/json",o=new Headers({Accept:r,"Content-Type":r});for(const[a,s]of e)o.set(a,s);const n=d("__Host-Cc-Session-Cookie");n&&o.set("X-Cc-Session",n);const i=d("__Host-cc-AuthToken");return i&&o.set("Authorization",i),{method:t,headers:o}}var m=null;function g(e,t=document){return t?t.querySelector(e):m}function y(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),o=new URL(e,r);for(const[n,i]of Object.entries(t))o.searchParams.set(n,i);return o.toString()}function w(e){return e.length}function x(e,t,r){return e.split(t,r)}var O=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),{ref:b,createApp:S}=window.Vue,_="00:00:00",C=`${h}/api:y0t3fimN`,P="/order-confirmation",E="order-id";function I(){return c(this,arguments,function*(e={}){try{const r=yield fetch(`${h}/api:ltSOgTnO/beacon`,l(s({},v([],"POST")),{body:(t=e,JSON.stringify(t)),keepalive:!0}));if(!r.ok){const e=yield r.json();return p(null==e?void 0:e.message)}return f(yield r.json())}catch(r){return p("Falha ao enviar o log de erro")}var t})}var j=S({name:"PIXProcessPage",setup:()=>({hasEventSource:b(m)}),data:()=>({now:Date.now(),isLoading:!0,hasCopied:!1,order:m,nowInterval:m}),created(){return c(this,null,function*(){this.hasEventSource="EventSource"in window;const e=new URLSearchParams(location.search).get(E);if(!e)return void(location.href=y("/",{reason:"no_transaction_id"}));const t=yield this.getOrder(e);return t.succeeded?"pix"!==t.data.payment_method?(I(t),void(location.href=y("/",{reason:"wrong_payment_method"}))):(this.isLoading=!1,this.order=t.data,window.Vue.nextTick(()=>this.setQRImage()),void(t.data.pago?setTimeout(()=>{location.href=y(P,{[E]:e})},5e3):t.data.expired||(this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.hasEventSource&&this.pollOrder(e)))):(I(l(s({},t),{reason:"request_response_failed"})),void(location.href=y("/",{reason:"request_response_failed"})))})},methods:{pollOrder(e){const t=new EventSource(`${C}/confirm-pix/${e}`);t.addEventListener("message",r=>c(this,null,function*(){const o=function(e){if("string"!=typeof e)return m;try{return JSON.parse(e)}catch(t){return m}}(r.data);o!==m&&(this.patchOrder(l(s({},o),{expired:_===this.timmer||o.expired})),(this.hasPaid||this.isExpired)&&(t.readyState!==t.CLOSED&&t.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=y(P,{[E]:e})},5e3))})),document.addEventListener("beforeunload",()=>{t.readyState!==t.CLOSED&&(t.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:r}){this.order&&(this.order.pago=e,this.order.total=r,this.order.expired=t)},getOrder(e){return c(this,null,function*(){var t;const r="Falha ao capturar o pedido";try{const o=yield fetch(`${C}/confirm-pix/${e}/rest`,s({},v()));if(!o.ok){const e=yield o.json();return p.call(o,(null!=(t=null==e?void 0:e.message)?t:r)+" ST")}const n=yield o.json();return f.call(o,n)}catch(o){return p(r+" ND")}})},handleCopyQRCode(){return c(this,null,function*(){var e,t,r,o;if(!this.hasCopied){if(this.hasCopied=!0,navigator.clipboard.writeText)yield navigator.clipboard.writeText(null!=(t=null==(e=this.order)?void 0:e.qrcode_text)?t:"");else{const e=document.createElement("input");document.body.appendChild(e),e.value=null!=(o=null==(r=this.order)?void 0:r.qrcode_text)?o:"",e.select(),document.execCommand("copy"),document.body.removeChild(e)}setTimeout(()=>this.hasCopied=!1,3e3)}})},setQRImage(){var e,t,r;const o=g("[data-wtf-qr-code-image]");var n;o&&(o.onload=()=>{return!!(e=g("[data-wtf-loader]"))&&e.classList.toggle("oculto",!0);var e},function(e,t,r){e&&e.setAttribute("src",r)}(o,0,null!=(r=null!=(t=null==(e=this.order)?void 0:e.qrcode)?t:(n=o)?n.getAttribute("src"):m)?r:""))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=m}},computed:{orderPrice(){const{order:e}=this;return O.format(e?e.total:0)},timmer(){var e,t;if(!this.order||this.isExpired)return _;const r=Math.floor(Math.max((null!=(t=null==(e=this.order)?void 0:e.due_time)?t:0)-this.now,0)/1e3);return[Math.floor(r/3600),Math.floor(r%3600/60),r%60].map(e=>e.toString().padStart(2,"0")).join(":")},hasPaid(){var e,t;return null!=(t=null==(e=this.order)?void 0:e.pago)&&t},isExpired(){var e,t;return null!=(t=null==(e=this.order)?void 0:e.expired)&&t},getQRCode(){var e,t;return null!=(t=null==(e=this.order)?void 0:e.qrcode_text)?t:""}},watch:{timmer(e){var t,r,o,n;e===_&&this.patchOrder({expired:!0,total:null!=(r=null==(t=this.order)?void 0:t.total)?r:0,pago:null!=(n=null==(o=this.order)?void 0:o.pago)&&n})}}}),L=g("#pixProcess");L?j.mount(L):location.href=y("/",{reason:"pix_element_not_found"}),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();