!function(e){"use strict";function t(e){const t=m(document.cookie,"; ").find(t=>{const{name:r}=o(t);return r===e});return!!t&&o(t).value}function o(e){const[t,...o]=m(e,"=");return{name:t,value:p(o)>0&&decodeURIComponent(o.join("="))}}var r="https://xef5-44zo-gegm.b2.xano.io",n="__Host-Cc-Session-Cookie",a="X-Cc-Session";function i(e){const t=e?.headers.get(a);t&&function(e,t,o={}){if(0===p(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===p(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const r=[`${e}=${encodeURIComponent(t)}`];o?.expires&&o?.expires instanceof Date&&r.push("expires="+o.expires.toUTCString()),o.maxAge&&r.push(`maxAge=${o.maxAge}`),o?.sameSite&&"string"==typeof o?.sameSite&&r.push(`SameSite=${o?.sameSite}`),o?.path&&r.push(`path=${o?.path}`),o?.domain&&r.push(`domain=${o?.domain}`),o?.httpOnly&&r.push("HttpOnly"),o?.secure&&r.push("Secure");const n=r.join("; ");document.cookie=n}(n,t,{path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)})}function s(e,t=!1,o){return i(this),t||this&&401===this.status&&(location.href=l("/log-in",{redirect_to:encodeURIComponent(location.pathname+location.search)})),o?.(),{message:e,succeeded:!1}}function c(e,t){return i(this),t?.(),{data:e,succeeded:!0}}function d(e=[],o="GET"){const r="application/json",i=new Headers({Accept:r,"Content-Type":r});for(const[t,n]of e)i.set(t,n);const s=t(n);s&&i.set(a,s);const c=t("__Host-cc-AuthToken");return c&&i.set("Authorization",c),{method:o,headers:i}}var h=null;function u(e,t=document){return t?t.querySelector(e):h}function l(e,t={}){const o=new URL(`${location.protocol}//${location.hostname}`),r=new URL(e,o);for(const[n,a]of Object.entries(t))r.searchParams.set(n,a);return r.toString()}function p(e){return e.length}function m(e,t,o){return e.split(t,o)}var f=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),g="00:00:00",w=`${r}/api:niMKesyM`,v="/pagamento/confirmacao-do-pedido",x="order-id",S=e.defineComponent({name:"PIXProcessPage",setup:()=>({hasEventSource:e.ref(h)}),data:()=>({now:Date.now(),isLoading:!0,hasCopied:!1,order:h,nowInterval:h}),async created(){this.hasEventSource="EventSource"in window;const e=new URLSearchParams(location.search).get(x);if(!e)return void(location.href=l("/",{reason:"no_transaction_id"}));const t=await this.getOrder(e);if(!t.succeeded)return async function(e={}){try{const o=await fetch(`${r}/api:ltSOgTnO/beacon`,{...d([],"POST"),body:(t={custom:e,environment:{url:location.protocol.concat("//",location.hostname,location.pathname,location.search)}},JSON.stringify(t)),keepalive:!0});if(!o.ok){const e=await o.json();return s(e?.message)}return c(await o.json())}catch(o){return s("Falha ao enviar o log de erro")}var t}({...t,reason:"request_response_failed"}),void(location.href=l("/",{reason:"request_response_failed"}));this.isLoading=!1,this.order=t.data,this.$nextTick(()=>this.setQRImage()),t.data.pago?setTimeout(()=>{location.href=l(v,{[x]:e})},5e3):t.data.expired||(this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.hasEventSource&&this.pollOrder(e))},methods:{pollOrder(e){const t=new EventSource(`${w}/confirm-pix/${e}`);t.addEventListener("message",async o=>{const r=function(e){if("string"!=typeof e)return h;try{return JSON.parse(e)}catch{return h}}(o.data);r!==h&&(this.patchOrder({...r,expired:g===this.timmer||r.expired}),(this.hasPaid||this.isExpired)&&(t.readyState!==t.CLOSED&&t.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=l(v,{[x]:e})},5e3))}),document.addEventListener("beforeunload",()=>{t.readyState!==t.CLOSED&&(t.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:o}){this.order&&(this.order.pago=e,this.order.total=o,this.order.expired=t)},async getOrder(e){const t="Falha ao capturar o pedido";try{const o=await fetch(`${w}/confirm-pix/${e}/rest`,{...d(),priority:"high"});if(!o.ok){const e=await o.json();return s.call(o,e?.message??t)}const r=await o.json();return c.call(o,r)}catch(o){return s(t)}},async handleCopyQRCode(){if(!this.hasCopied){if(this.hasCopied=!0,navigator.clipboard.writeText)await navigator.clipboard.writeText(this.order?.qrcode_text??"");else{const e=document.createElement("input");document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e)}setTimeout(()=>this.hasCopied=!1,3e3)}},setQRImage(){const e=u("[data-wtf-qr-code-image]");var t;e&&(e.onload=()=>{return!!(e=u("[data-wtf-loader]"))&&e.classList.toggle("oculto",!0);var e},function(e,t,o){e&&e.setAttribute("src",o)}(e,0,this.order?.qrcode??((t=e)?t.getAttribute("src"):h)??""))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=h}},computed:{orderPrice(){const{order:e}=this;return f.format(e?e.total/100:0)},timmer(){if(!this.order||this.isExpired)return g;const e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3);return[Math.floor(e/3600),Math.floor(e%3600/60),e%60].map(e=>e.toString().padStart(2,"0")).join(":")},hasPaid(){return this.order?.pago??!1},isExpired(){return this.order?.expired??!1},getQRCode(){return this.order?.qrcode_text??""}},watch:{timmer(e){e===g&&this.patchOrder({expired:!0,total:this.order?.total??0,pago:this.order?.pago??!1})}}}),y=u("#pixProcess");y?e.createApp(S).mount(y):location.href=l("/",{reason:"pix_element_not_found"}),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}(Vue);