!function(){"use strict";function e(e){const o=d(document.cookie,"; ").find(o=>{const{name:r}=t(o);return r===e});return!!o&&t(o).value}function t(e){const[t,...o]=d(e,"=");return{name:t,value:c(o)>0&&decodeURIComponent(o.join("="))}}function o(e,t=!1,o){return t||this&&401===this.status&&(location.href=s("/log-in",{redirect_to:encodeURIComponent(location.pathname+location.search)})),o?.(),{message:e,succeeded:!1}}function r(e,t){return t?.(),{data:e,succeeded:!0}}function n(t=[],o="GET"){const r="application/json",n=new Headers({Accept:r,"Content-Type":r});for(const[e,s]of t)n.set(e,s);const a=e("__Host-Cc-Session-Cookie");a&&n.set("X-Cc-Session",a);const i=e("__Host-cc-AuthToken");return i&&n.set("Authorization",i),{method:o,headers:n}}var a=null;function i(e,t=document){return t?t.querySelector(e):a}function s(e,t={}){const o=new URL(`${location.protocol}//${location.hostname}`),r=new URL(e,o);for(const[n,a]of Object.entries(t))r.searchParams.set(n,a);return r.toString()}function c(e){return e.length}function d(e,t,o){return e.split(t,o)}var h=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),{ref:u,createApp:l}=window.Vue,p="00:00:00",m="https://xef5-44zo-gegm.b2.xano.io/api:y0t3fimN",f="/order-confirmation",w="order-id",g=l({name:"PIXProcessPage",setup:()=>({hasEventSource:u(a)}),data:()=>({now:Date.now(),isLoading:!0,hasCopied:!1,order:a,nowInterval:a}),async created(){this.hasEventSource="EventSource"in window;const e=new URLSearchParams(location.search).get(w);if(!e)return void(location.href=s("/",{reason:"no_transaction_id"}));const t=await this.getOrder(e);t.succeeded?"pix"===t.data.payment_method?(this.isLoading=!1,this.order=t.data,window.Vue.nextTick(()=>this.setQRImage()),t.data.pago?setTimeout(()=>{location.href=s(f,{[w]:e})},5e3):t.data.expired||(this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.hasEventSource&&this.pollOrder(e))):location.href=s("/",{reason:"wrong_payment_method"}):location.href=s("/",{reason:"request_response_failed"})},methods:{pollOrder(e){const t=new EventSource(`${m}/confirm-pix/${e}`);t.addEventListener("message",async o=>{const r=function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return a}}(o.data);r!==a&&(this.patchOrder({...r,expired:p===this.timmer||r.expired}),(this.hasPaid||this.isExpired)&&(t.readyState!==t.CLOSED&&t.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=s(f,{[w]:e})},5e3))}),document.addEventListener("beforeunload",()=>{t.readyState!==t.CLOSED&&(t.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:o}){this.order&&(this.order.pago=e,this.order.total=o,this.order.expired=t)},async getOrder(e){const t="Falha ao capturar o pedido";try{const a=await fetch(`${m}/confirm-pix/${e}/rest`,{...n()});if(!a.ok){const e=await a.json();return o.call(a,e?.message??t)}const i=await a.json();return r.call(a,i)}catch(a){return o(t)}},async handleCopyQRCode(){if(!this.hasCopied){if(this.hasCopied=!0,navigator.clipboard.writeText)await navigator.clipboard.writeText(this.order?.qrcode_text??"");else{const e=document.createElement("input");document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e)}setTimeout(()=>this.hasCopied=!1,3e3)}},setQRImage(){const e=i("[data-wtf-qr-code-image]");var t;e&&(e.onload=()=>{return!!(e=i("[data-wtf-loader]"))&&e.classList.toggle("oculto",!0);var e},function(e,t,o){e&&e.setAttribute("src",o)}(e,0,this.order?.qrcode??((t=e)?t.getAttribute("src"):a)??""))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=a}},computed:{orderPrice(){const{order:e}=this;return h.format(e?e.total:0)},timmer(){if(!this.order||this.isExpired)return p;const e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3);return[Math.floor(e/3600),Math.floor(e%3600/60),e%60].map(e=>e.toString().padStart(2,"0")).join(":")},hasPaid(){return this.order?.pago??!1},isExpired(){return this.order?.expired??!1},getQRCode(){return this.order?.qrcode_text??""}},watch:{timmer(e){e===p&&this.patchOrder({expired:!0,total:this.order?.total??0,pago:this.order?.pago??!1})}}}),v=i("#pixProcess");v?g.mount(v):location.href=s("/",{reason:"pix_element_not_found"}),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();