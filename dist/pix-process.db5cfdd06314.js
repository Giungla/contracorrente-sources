!function(){"use strict";function e(e){const o=h(document.cookie,"; ").find(o=>{const{name:r}=t(o);return r===e});return!!o&&t(o).value}function t(e){const[t,...o]=h(e,"=");return{name:t,value:d(o)>0&&decodeURIComponent(o.join("="))}}var o="https://xef5-44zo-gegm.b2.xano.io";function r(e,t=!1,o){return t||this&&401===this.status&&(location.href=c("/log-in",{redirect_to:encodeURIComponent(location.pathname+location.search)})),o?.(),{message:e,succeeded:!1}}function n(e,t){return t?.(),{data:e,succeeded:!0}}function a(t=[],o="GET"){const r="application/json",n=new Headers({Accept:r,"Content-Type":r});for(const[e,s]of t)n.set(e,s);const a=e("__Host-Cc-Session-Cookie");a&&n.set("X-Cc-Session",a);const i=e("__Host-cc-AuthToken");return i&&n.set("Authorization",i),{method:o,headers:n}}var i=null;function s(e,t=document){return t?t.querySelector(e):i}function c(e,t={}){const o=new URL(`${location.protocol}//${location.hostname}`),r=new URL(e,o);for(const[n,a]of Object.entries(t))r.searchParams.set(n,a);return r.toString()}function d(e){return e.length}function h(e,t,o){return e.split(t,o)}var u=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),{ref:l,createApp:p}=window.Vue,m="00:00:00",f=`${o}/api:y0t3fimN`,w="/order-confirmation",g="order-id";async function v(e={}){try{const i=await fetch(`${o}/api:ltSOgTnO/beacon`,{...a([],"POST"),body:(t=e,JSON.stringify(t)),keepalive:!0});if(!i.ok){const e=await i.json();return r(e?.message)}return n(await i.json())}catch(i){return r("Falha ao enviar o log de erro")}var t}var x=p({name:"PIXProcessPage",setup:()=>({hasEventSource:l(i)}),data:()=>({now:Date.now(),isLoading:!0,hasCopied:!1,order:i,nowInterval:i}),async created(){this.hasEventSource="EventSource"in window;const e=new URLSearchParams(location.search).get(g);if(!e)return void(location.href=c("/",{reason:"no_transaction_id"}));const t=await this.getOrder(e);return t.succeeded?"pix"!==t.data.payment_method?(v(t),void(location.href=c("/",{reason:"wrong_payment_method"}))):(this.isLoading=!1,this.order=t.data,window.Vue.nextTick(()=>this.setQRImage()),void(t.data.pago?setTimeout(()=>{location.href=c(w,{[g]:e})},5e3):t.data.expired||(this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.hasEventSource&&this.pollOrder(e)))):(v({...t,reason:"request_response_failed"}),void(location.href=c("/",{reason:"request_response_failed"})))},methods:{pollOrder(e){const t=new EventSource(`${f}/confirm-pix/${e}`);t.addEventListener("message",async o=>{const r=function(e){if("string"!=typeof e)return i;try{return JSON.parse(e)}catch{return i}}(o.data);r!==i&&(this.patchOrder({...r,expired:m===this.timmer||r.expired}),(this.hasPaid||this.isExpired)&&(t.readyState!==t.CLOSED&&t.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=c(w,{[g]:e})},5e3))}),document.addEventListener("beforeunload",()=>{t.readyState!==t.CLOSED&&(t.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:o}){this.order&&(this.order.pago=e,this.order.total=o,this.order.expired=t)},async getOrder(e){const t="Falha ao capturar o pedido";try{const o=await fetch(`${f}/confirm-pix/${e}/rest`,{...a()});if(!o.ok){const e=await o.json();return r.call(o,e?.message??t)}const i=await o.json();return n.call(o,i)}catch(o){return r(t)}},async handleCopyQRCode(){if(!this.hasCopied){if(this.hasCopied=!0,navigator.clipboard.writeText)await navigator.clipboard.writeText(this.order?.qrcode_text??"");else{const e=document.createElement("input");document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e)}setTimeout(()=>this.hasCopied=!1,3e3)}},setQRImage(){const e=s("[data-wtf-qr-code-image]");var t;e&&(e.onload=()=>{return!!(e=s("[data-wtf-loader]"))&&e.classList.toggle("oculto",!0);var e},function(e,t,o){e&&e.setAttribute("src",o)}(e,0,this.order?.qrcode??((t=e)?t.getAttribute("src"):i)??""))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=i}},computed:{orderPrice(){const{order:e}=this;return u.format(e?e.total:0)},timmer(){if(!this.order||this.isExpired)return m;const e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3);return[Math.floor(e/3600),Math.floor(e%3600/60),e%60].map(e=>e.toString().padStart(2,"0")).join(":")},hasPaid(){return this.order?.pago??!1},isExpired(){return this.order?.expired??!1},getQRCode(){return this.order?.qrcode_text??""}},watch:{timmer(e){e===m&&this.patchOrder({expired:!0,total:this.order?.total??0,pago:this.order?.pago??!1})}}}),y=s("#pixProcess");y?x.mount(y):location.href=c("/",{reason:"pix_element_not_found"}),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();