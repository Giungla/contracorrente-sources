!function(){"use strict";var e="POST",t="https://xef5-44zo-gegm.b2.xano.io",n="contra_corrente_cep";function i(e,t,n){return e?t.push(n):-1}function r(e){const t=L(document.cookie,"; ").find(t=>{const{name:n}=a(t);return n===e});return!!t&&a(t).value}function a(e){const[t,...n]=L(e,"=");return{name:t,value:_(n)>0&&decodeURIComponent(n.join("="))}}var o="__Host-cc-AuthToken",s="__Host-Cc-Session-Cookie",c="X-Cc-Session";function u(e){const t=e?.headers.get(c);t&&function(e,t,n={}){if(0===_(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===_(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const i=[`${e}=${encodeURIComponent(t)}`];n?.expires&&n?.expires instanceof Date&&i.push("expires="+n.expires.toUTCString()),n.maxAge&&i.push(`maxAge=${n.maxAge}`),n?.sameSite&&"string"==typeof n?.sameSite&&i.push(`SameSite=${n?.sameSite}`),n?.path&&i.push(`path=${n?.path}`),n?.domain&&i.push(`domain=${n?.domain}`),n?.httpOnly&&i.push("HttpOnly"),n?.secure&&i.push("Secure");const r=i.join("; ");document.cookie=r}(s,t,{path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)})}function d(e,t=!1,n){return u(this),t||this&&401===this.status&&(location.href=S("/log-in",{redirect_to:encodeURIComponent(location.pathname+location.search)})),n?.(),{message:e,succeeded:!1}}function l(e,t){return u(this),t?.(),{data:e,succeeded:!0}}function f(e=[],t="GET"){const n="application/json",i=new Headers({Accept:n,"Content-Type":n});for(const[r,o]of e)i.set(r,o);const a=r(s);a&&i.set(c,a);const u=r(o);return u&&i.set("Authorization",u),{method:t,headers:i}}var p=null,m="oculto";function h(e,t=document){return t?t.querySelector(e):p}function g(e,t,n,i){if(e)return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function y(e,...t){e&&e.classList.add(...t)}function w(e,...t){e&&e.classList.remove(...t)}function v(e,t,n){return!!e&&e.classList.toggle(t,n)}function k(e,t){e&&(e.textContent="string"==typeof t?t:t.toString())}function S(e,t={}){const n=new URL(`${location.protocol}//${location.hostname}`),i=new URL(e,n);for(const[r,a]of Object.entries(t))i.searchParams.set(r,a);return i.toString()}function b(e){return JSON.stringify(e)}function C(e){return e.replace(/\D+/g,"")}function _(e){return e.length}function P(){return/^\d{5}-\d{3}$/}function E(e){return e instanceof HTMLInputElement}function L(e,t,n){return e.split(t,n)}function I(e){return e===p}var q=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function R(e,t,n){return Math.max(e,Math.min(t,n))}var $={PRICE:"price",FULL_PRICE:"full_price"};function U(){return!1!==r(o)?"user":"guest"}var x=location.pathname.split("/").at(-1);if(!x)throw new Error("Slug do produto não foi encontrado");var D=h("[data-sku-selector]");if(!D)throw new Error("Impossível realizar a seleção de SKUs");var j="high",T="strikethrough",F=D.parentElement,H=h("[data-wtf-sku-price]"),M=h("[data-wtf-sku-full-price]"),O=h("[data-wtf-trigger-add-cep]"),A=h("#spp-calculo-do-cep"),N=h("#spp-campo-de-cep"),B=h("[data-wtf-trigger-add-cep-container]"),z=h("#spp-mensagem-de-erro-campo-de-cep"),K=h("#spp-custo-do-frete-bloco"),G=h("#spp-custo-do-frete");h("[data-wtf-subscriber-view-price]");var J=h("#spp-custo-do-frete-mudar-cep");g(h("[data-wtf-quantity-minus]"),"click",e=>{Y(-1)}),g(h("[data-wtf-quantity-plus]"),"click",e=>{Y(1)}),g(O,"click",e=>{v(B,m,!0),w(A,m)}),g(N,"input",async e=>{if(!e.isTrusted)return;const t=e.target;E(t)&&Q(t)}),g(h("[data-wtf-buy-now]"),"click",async e=>{e.isTrusted&&await V(!0)}),g(h("[data-wtf-add-to-cart]"),"click",async e=>{e.isTrusted&&await V()});var X=new Proxy({selectedSku:p,shippingCEP:p,quantity:1,isSubscriber:!1,skus:[],isDeliveryLoading:!1,deliveryPrice:p,isManipulatingCart:!1},{get(e,t){switch(t){case $.PRICE:case $.FULL_PRICE:{const e=te();return e?e[t]/100:0}case"singleItemPrice":{const t=te();if(!t)return 0;const{[$.PRICE]:n,[$.FULL_PRICE]:i}=t,r=R(0,1,.7);return e.isSubscriber?W(i,n)?n:i*r:n}case"final_price":{const{quantity:t,deliveryPrice:n}=e,i=n??0;return(X.singleItemPrice*t+i)/100}case"hasSamePrices":{const e=te();return!!e&&e[$.PRICE]===e[$.FULL_PRICE]}}return Reflect.get(e,t)},set(e,t,n){const i=Reflect.set(e,t,n);switch(t){case"selectedSku":!function(){const e=document.createDocumentFragment();for(const t of X.skus){const n=D.cloneNode(!0),i=t.sku_id===X.selectedSku;k(n,t.variation_type),v(n,"selecionado",i),g(n,"click",e=>{e.preventDefault(),e.stopPropagation(),i||(X.selectedSku=t.sku_id,1!==X.quantity&&(X.quantity=1))}),e.appendChild(n)}F.replaceChildren(e)}(),function(){const{price:e,full_price:t,isSubscriber:n,hasSamePrices:i,singleItemPrice:r}=X;k(H,q.format(e)),k(M,q.format(i?0:t));const a=W(t,e),o=v(h("[data-wtf-full-price-view]"),m,n&&i);v(H,T,n&&a),v(h("[data-wtf-price-view]"),m,n&&(!i||a)),v(H,T,n&&o),v(h("[data-wtf-subscriber-view-price]"),m,!n),k(h("[data-wtf-sku-subscriber-price]"),q.format(r/100))}(),Z();break;case"quantity":{k(h("[data-wtf-quantity-value]"),X.quantity),Z();const{shippingCEP:t}=e;I(t)||8!==_(t)||ne()}break;case"shippingCEP":ne().then(()=>{y(B,m)});break;case"isDeliveryLoading":break;case"deliveryPrice":w(K,m),k(G,q.format(n/100)),g(J,"click",e=>{e.isTrusted&&ee()},{once:!0}),Z();break;case"isSubscriber":Z()}return i}});async function Q(e){const t=C(e.value).replace(/^(\d{0,5})(\d{0,3})/,(e,t,n)=>{const r=[];for(const a of[t,n])i(a,r,a);return r.join("-")});var n,r;e.value=t,X.shippingCEP=(r=t,("function"==typeof(n=P)?n():n).test(r)?C(t):p)}async function V(n){if(X.isManipulatingCart)return;X.isManipulatingCart=!0;const{quantity:i,selectedSku:r}=X;if(!r)throw new Error("Nenhum SKU foi selecionado");const a=await async function(n){const i="Houve uma falha na adição do produto",r=U();try{const a=await fetch(`${t}/api:b9-USIEf/cart/handle/${r}`,{...f([],e),body:b(n),priority:j,keepalive:!0});if(!a.ok){const e=await a.json();return d.call(a,e?.message??i)}const o=await a.json();return l.call(a,o)}catch(a){return d(i)}}({item:{quantity:i,sku_id:r,reference_id:x},operation:"add",...n&&{immediate:n}});if(X.isManipulatingCart=!1,!a.succeeded)return alert(a.message??"Não foi possível adicionar o produto no seu carrinho");X.quantity=1,y(h("#carrinho-flutuante"),"carrinhoflutuante--visible"),localStorage.setItem("editora_contracorrente_cart_items",b(a.data))}function W(e,t){return e*R(0,1,.7)>=t}function Y(e){if(X.isDeliveryLoading)return;const t=te();if(!t)throw new Error("SKU was not specified");const n=R(1,10,R(1,X.quantity+e,t.inventory));n!==X.quantity&&(X.quantity=n)}function Z(){k(h("[data-wtf-sku-final-price]"),q.format(X.final_price))}function ee(){N&&(N.value=""),X.shippingCEP=p,X.deliveryPrice=p,y(z,m),w(A,m),y(K,m),k(G,q.format(0))}function te(){const{skus:e,selectedSku:t}=X;return e.find(e=>t===e.sku_id)}async function ne(){if(X.isDeliveryLoading)return;const{quantity:i,shippingCEP:r}=X;if(I(r)||!x)throw new Error("Invalid parameters provided to `getDeliveryInfo` function");const a=await async function(n){const i="Houve uma falha ao buscar os dados de entrega";X.isDeliveryLoading=!0;try{const r=await fetch(`${t}/api:_4BO6C7F/delivery-price`,{...f([],e),priority:j,body:b(n)});if(!r.ok){const e=await r.json();return d.call(r,e?.message??i,!0)}const a=await r.json();return l.call(r,a)}catch(r){return d(i)}finally{X.isDeliveryLoading=!1}}({quantity:i,cep:r,product_slug:x});if(y(A,m),!a.succeeded)return navigator.vibrate?.([50,20,50]),k(z,a.message),w(z,m),void setTimeout(ee,4e3);localStorage.setItem(n,r),X.deliveryPrice=a.data.pcFinal}Promise.allSettled([async function(e){const n="Houve uma falha ao buscar os dados do usuário",i=U();try{const r=await fetch(`${t}/api:_4BO6C7F/product/${e}/${i}`,{...f(),priority:j});if(!r.ok){const e=await r.json();return d.call(r,e?.message??n,!0)}const a=await r.json();return l.call(r,a)}catch(r){return d(n)}}(x).then(function(e){e.succeeded?(X.isSubscriber=e.data.is_subscriber??!1,X.skus=e.data.skus,X.selectedSku=e.data.skus.at(0)?.sku_id??p,localStorage.getItem(n)&&E(N)&&Q(N)):location.href=S("/",{reason:"product_not_founded"})})]),window.addEventListener("pageshow",e=>{e.persisted&&location.reload()})}();