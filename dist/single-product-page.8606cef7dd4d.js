!function(){"use strict";var e="POST",t="https://xef5-44zo-gegm.b2.xano.io",n="contra_corrente_cep";function r(e,t,n){return e?t.push(n):-1}function i(e){const t=L(document.cookie,"; ").find(t=>{const{name:n}=a(t);return n===e});return!!t&&a(t).value}function a(e){const[t,...n]=L(e,"=");return{name:t,value:_(n)>0&&decodeURIComponent(n.join("="))}}var o="__Host-cc-AuthToken",s="__Host-Cc-Session-Cookie",c="X-Cc-Session";function u(e){const t=e?.headers.get(c);t&&function(e,t,n={}){if(0===_(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===_(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const r=[`${e}=${encodeURIComponent(t)}`];n?.expires&&n?.expires instanceof Date&&r.push("expires="+n.expires.toUTCString()),n.maxAge&&r.push(`maxAge=${n.maxAge}`),n?.sameSite&&"string"==typeof n?.sameSite&&r.push(`SameSite=${n?.sameSite}`),n?.path&&r.push(`path=${n?.path}`),n?.domain&&r.push(`domain=${n?.domain}`),n?.httpOnly&&r.push("HttpOnly"),n?.secure&&r.push("Secure");const i=r.join("; ");document.cookie=i}(s,t,{path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)})}function d(e,t=!1,n){return u(this),t||this&&401===this.status&&(location.href=S("/log-in",{redirect_to:encodeURIComponent(location.pathname+location.search)})),n?.(),{message:e,succeeded:!1}}function l(e,t){return u(this),t?.(),{data:e,succeeded:!0}}function f(e=[],t="GET"){const n="application/json",r=new Headers({Accept:n,"Content-Type":n});for(const[i,o]of e)r.set(i,o);const a=i(s);a&&r.set(c,a);const u=i(o);return u&&r.set("Authorization",u),{method:t,headers:r}}var p=null,m="oculto";function h(e,t=document){return t?t.querySelector(e):p}function g(e,t,n,r){if(e)return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function y(e,...t){e&&e.classList.add(...t)}function w(e,...t){e&&e.classList.remove(...t)}function v(e,t,n){return!!e&&e.classList.toggle(t,n)}function k(e,t){e&&(e.textContent="string"==typeof t?t:t.toString())}function S(e,t={}){const n=new URL(`${location.protocol}//${location.hostname}`),r=new URL(e,n);for(const[i,a]of Object.entries(t))r.searchParams.set(i,a);return r.toString()}function b(e){return JSON.stringify(e)}function C(e){return e.replace(/\D+/g,"")}function _(e){return e.length}function P(){return/^\d{5}-\d{3}$/}function E(e){return e instanceof HTMLInputElement}function L(e,t,n){return e.split(t,n)}var I=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function q(e,t,n){return Math.max(e,Math.min(t,n))}var R={PRICE:"price",FULL_PRICE:"full_price"};function $(){return!1!==i(o)?"user":"guest"}var U=location.pathname.split("/").at(-1);if(!U)throw new Error("Slug do produto não foi encontrado");var x=h("[data-sku-selector]");if(!x)throw new Error("Impossível realizar a seleção de SKUs");var D="high",j="strikethrough",T=x.parentElement,F=h("[data-wtf-sku-price]"),H=h("[data-wtf-sku-full-price]"),M=h("[data-wtf-trigger-add-cep]"),O=h("#spp-calculo-do-cep"),A=h("#spp-campo-de-cep"),N=h("[data-wtf-trigger-add-cep-container]"),B=h("#spp-mensagem-de-erro-campo-de-cep"),z=h("#spp-custo-do-frete-bloco"),K=h("#spp-custo-do-frete");h("[data-wtf-subscriber-view-price]");var G=h("#spp-custo-do-frete-mudar-cep");g(h("[data-wtf-quantity-minus]"),"click",e=>{V(-1)}),g(h("[data-wtf-quantity-plus]"),"click",e=>{V(1)}),g(M,"click",e=>{v(N,m,!0),w(O,m)}),g(A,"input",async e=>{if(!e.isTrusted)return;const t=e.target;E(t)&&async function(e){const t=C(e.value).replace(/^(\d{0,5})(\d{0,3})/,(e,t,n)=>{const i=[];for(const a of[t,n])r(a,i,a);return i.join("-")});var n,i;e.value=t,J.shippingCEP=(i=t,("function"==typeof(n=P)?n():n).test(i)?C(t):p)}(t)}),g(h("[data-wtf-buy-now]"),"click",async e=>{e.isTrusted&&await X(!0)}),g(h("[data-wtf-add-to-cart]"),"click",async e=>{e.isTrusted&&await X()});var J=new Proxy({selectedSku:p,shippingCEP:p,quantity:1,isSubscriber:!1,skus:[],isDeliveryLoading:!1,deliveryPrice:p,isManipulatingCart:!1},{get(e,t){switch(t){case R.PRICE:case R.FULL_PRICE:{const e=Z();return e?e[t]/100:0}case"singleItemPrice":{const t=Z();if(!t)return 0;const{[R.PRICE]:n,[R.FULL_PRICE]:r}=t,i=q(0,1,.7);return e.isSubscriber?Q(r,n)?n:r*i:n}case"final_price":{const{quantity:t,deliveryPrice:n}=e,r=n??0;return(J.singleItemPrice*t+r)/100}case"hasSamePrices":{const e=Z();return!!e&&e[R.PRICE]===e[R.FULL_PRICE]}}return Reflect.get(e,t)},set(e,t,n){const r=Reflect.set(e,t,n);switch(t){case"selectedSku":!function(){const e=document.createDocumentFragment();for(const t of J.skus){const n=x.cloneNode(!0),r=t.sku_id===J.selectedSku;k(n,t.variation_type),v(n,"selecionado",r),g(n,"click",e=>{e.preventDefault(),e.stopPropagation(),r||(J.selectedSku=t.sku_id,1!==J.quantity&&(J.quantity=1))}),e.appendChild(n)}T.replaceChildren(e)}(),function(){const{price:e,full_price:t,isSubscriber:n,hasSamePrices:r,singleItemPrice:i}=J;k(F,I.format(e)),k(H,I.format(r?0:t));const a=Q(t,e),o=v(h("[data-wtf-full-price-view]"),m,n&&r);v(F,j,n&&a),v(h("[data-wtf-price-view]"),m,n&&(!r||a)),v(F,j,n&&o),v(h("[data-wtf-subscriber-view-price]"),m,!n),k(h("[data-wtf-sku-subscriber-price]"),I.format(i/100))}(),W();break;case"quantity":k(h("[data-wtf-quantity-value]"),J.quantity),W(),ee();break;case"shippingCEP":ee().then(e=>{e&&y(N,m)});break;case"isDeliveryLoading":break;case"deliveryPrice":w(z,m),k(K,I.format(n/100)),g(G,"click",e=>{e.isTrusted&&Y()},{once:!0}),W();break;case"isSubscriber":W()}return r}});async function X(n){if(J.isManipulatingCart)return;J.isManipulatingCart=!0;const{quantity:r,selectedSku:i}=J;if(!i)throw new Error("Nenhum SKU foi selecionado");const a=await async function(n){const r="Houve uma falha na adição do produto",i=$();try{const a=await fetch(`${t}/api:b9-USIEf/cart/handle/${i}`,{...f([],e),body:b(n),priority:D,keepalive:!0});if(!a.ok){const e=await a.json();return d.call(a,e?.message??r)}const o=await a.json();return l.call(a,o)}catch(a){return d(r)}}({item:{quantity:r,sku_id:i,reference_id:U},operation:"add",...n&&{immediate:n}});if(J.isManipulatingCart=!1,!a.succeeded)return alert(a.message??"Não foi possível adicionar o produto no seu carrinho");J.quantity=1,y(h("#carrinho-flutuante"),"carrinhoflutuante--visible"),localStorage.setItem("editora_contracorrente_cart_items",b(a.data))}function Q(e,t){return e*q(0,1,.7)>=t}function V(e){if(J.isDeliveryLoading)return;const t=Z();if(!t)throw new Error("SKU was not specified");const n=q(1,10,q(1,J.quantity+e,t.inventory));n!==J.quantity&&(J.quantity=n)}function W(){k(h("[data-wtf-sku-final-price]"),I.format(J.final_price))}function Y(){A&&(A.value=""),J.shippingCEP=p,J.deliveryPrice=p,y(B,m),w(O,m),y(z,m),k(K,I.format(0))}function Z(){const{skus:e,selectedSku:t}=J;return e.find(e=>t===e.sku_id)}async function ee(){const{quantity:r,shippingCEP:i,isDeliveryLoading:a}=J;if(a||i===p||8!==_(i))return!1;if(!U)throw new Error("Invalid parameters provided to `getDeliveryInfo` function");const o=await async function(n){const r="Houve uma falha ao buscar os dados de entrega";J.isDeliveryLoading=!0;try{const i=await fetch(`${t}/api:_4BO6C7F/delivery-price`,{...f([],e),priority:D,body:b(n)});if(!i.ok){const e=await i.json();return d.call(i,e?.message??r,!0)}const a=await i.json();return l.call(i,a)}catch(i){return d(r)}finally{J.isDeliveryLoading=!1}}({quantity:r,cep:i,product_slug:U});return y(O,m),o.succeeded?(localStorage.setItem(n,i),J.deliveryPrice=o.data.pcFinal,!0):(navigator.vibrate?.([50,20,50]),k(B,o.message),w(B,m),setTimeout(Y,4e3),!1)}Promise.allSettled([async function(e){const n="Houve uma falha ao buscar os dados do usuário",r=$();try{const i=await fetch(`${t}/api:_4BO6C7F/product/${e}/${r}`,{...f(),priority:D});if(!i.ok){const e=await i.json();return d.call(i,e?.message??n,!0)}const a=await i.json();return l.call(i,a)}catch(i){return d(n)}}(U).then(function(e){if(!e.succeeded)return void(location.href=S("/",{reason:"product_not_founded"}));J.isSubscriber=e.data.is_subscriber??!1,J.skus=e.data.skus,J.selectedSku=e.data.skus.at(0)?.sku_id??p;const t=localStorage.getItem(n);t&&E(A)&&(J.shippingCEP=C(t))})]),window.addEventListener("pageshow",e=>{e.persisted&&location.reload()})}();