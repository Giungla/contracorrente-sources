!function(){"use strict";function e(e,t=!1){return{message:e,succeeded:!1}}function t(e){return{data:e,succeeded:!0}}function r(e=[],t="GET"){const r="application/json",o=new Headers({Accept:r,"Content-Type":r});for(const[i,s]of e)o.set(i,s);const a=s("__Host-Cc-Session-Cookie");a&&o.set("X-Cc-Session",a);const n=s("__Host-cc-AuthToken");return n&&o.set("Authorization",n),{method:t,headers:o}}var o=null;function a(e,t=document){return t?t.querySelector(e):o}function n(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),o=new URL(e,r);for(const[a,n]of Object.entries(t))o.searchParams.set(a,n);return o.toString()}var i="; ";function s(e){const t=document.cookie.split(i).find(t=>{const{name:r}=c(t);return r===e});return!!t&&c(t).value}function c(e){const[t,r]=e.split("=");return{name:t,value:r}}var d=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),{createApp:h}=window.Vue,u="00:00:00",l="https://xef5-44zo-gegm.b2.xano.io/api:5lp3Lw8X",p="/pagamento/confirmacao-do-pedido";h({name:"PIXProcessPage",setup:()=>({hasEventSource:window.Vue.shallowRef(o)}),data:()=>({now:Date.now(),isLoading:!0,hasCopied:!1,order:o,nowInterval:o}),async created(){this.hasEventSource="EventSource"in window;const e=new URLSearchParams(location.search).get("order");if(!e)return void(location.href=n("/"));const t=await this.getOrder(e);t.succeeded&&"pix"===t.data.payment_method?(this.isLoading=!1,this.order=t.data,window.Vue.nextTick(()=>this.setQRImage()),t.data.pago?setTimeout(()=>{location.href=n(p,{order:e})},5e3):t.data.expired||(this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.hasEventSource&&this.pollOrder(e))):location.href=n("/")},methods:{pollOrder(e){const t=new EventSource(`${l}/confirm-pix/${e}`);t.addEventListener("message",async r=>{const a=function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return o}}(r.data);a!==o&&(this.patchOrder({...a,expired:u===this.timmer||a.expired}),(this.hasPaid||this.isExpired)&&(t.readyState!==t.CLOSED&&t.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=n(p,{order:e})},5e3))}),document.addEventListener("beforeunload",()=>{t.readyState!==t.CLOSED&&(t.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:r}){this.order&&(this.order.pago=e,this.order.total=r,this.order.expired=t)},async getOrder(o){const a="Falha ao capturar o pedido";try{const n=await fetch(`${l}/confirm-pix/${o}/rest`,{...r()});if(!n.ok){const t=await n.json();return e.call(n,t?.message??a)}const i=await n.json();return t.call(n,i)}catch(n){return e(a)}},async handleCopyQRCode(){if(!this.hasCopied){if(this.hasCopied=!0,navigator.clipboard.writeText)await navigator.clipboard.writeText(this.order?.qrcode_text??"");else{const e=document.createElement("input");document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e)}setTimeout(()=>this.hasCopied=!1,3e3)}},setQRImage(){const e=a("[data-wtf-qr-code-image]");var t;e&&(e.onload=()=>{return!!(e=a("[data-wtf-loader]"))&&e.classList.toggle("oculto",!0);var e},function(e,t,r){e&&e.setAttribute("src",r)}(e,0,this.order?.qrcode??((t=e)?t.getAttribute("src"):o)))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=o}},computed:{orderPrice(){const{order:e}=this;return d.format(e?e.total/100:0)},timmer(){if(!this.order||this.isExpired)return u;const e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3);return[Math.floor(e/3600),Math.floor(e%3600/60),e%60].map(e=>e.toString().padStart(2,"0")).join(":")},hasPaid(){return this.order?.pago??!1},isExpired(){return this.order?.expired??!1},getQRCode(){return this.order?.qrcode_text??""}},watch:{timmer(e){e===u&&this.patchOrder({expired:!0,total:this.order?.total??0,pago:this.order?.pago??!1})}}}).mount(a("#pixProcess")),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();